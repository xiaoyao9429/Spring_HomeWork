<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>添加商品 - 商品管理系统</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- 头部 -->
    <header class="header">
        <div class="container">
            <h1>商品管理系统</h1>
        </div>
    </header>

    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="container">
            <ul>
                <li><a href="index.html">首页</a></li>
                <li><a href="product-list.html">商品列表</a></li>
                <li><a href="add-product.html">添加商品</a></li>
                <li><a href="manage-products.html">管理商品</a></li>
            </ul>
        </div>
    </nav>

    <!-- 主内容 -->
    <main class="main">
        <div class="container">
            <h2>添加新商品</h2>
            
            <form id="product-form" class="form" action="#" method="post">
                <div class="form-group">
                    <label for="product-name">商品名称</label>
                    <input type="text" id="product-name" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="product-price">商品价格</label>
                    <input type="number" id="product-price" name="price" step="0.01" min="0" required>
                </div>
                
                <div class="form-group">
                    <label for="product-description">商品描述</label>
                    <textarea id="product-description" name="description" rows="5" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="product-image">商品图片URL</label>
                    <input type="text" id="product-image" name="product_image">
                </div>
                
                <div class="form-group">
                    <label for="product-stock">库存数量</label>
                    <input type="number" id="product-stock" name="stock" min="0" required>
                </div>
                
                <div class="form-group">
                    <label for="product-category">商品分类</label>
                    <select id="product-category" name="category_id" required>
                        <option value="">请选择分类</option>
                        <!-- 分类将通过JavaScript动态加载 -->
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">添加商品</button>
                    <button type="reset" class="btn">重置表单</button>
                    <a href="product-list.html" class="btn btn-danger">取消</a>
                </div>
            </form>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 商品管理系统.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 加载分类数据
            loadCategories();
            
            // 表单提交事件
            const productForm = document.getElementById('product-form');
            productForm.addEventListener('submit', function(e) {
                e.preventDefault();
                addProduct();
            });
        });
        
        // 加载分类数据函数
        function loadCategories() {
            fetch('/categories')
            .then(response => response.json())
            .then(data => {
                if (data.code === 200 && data.data) {
                    const categories = data.data;
                    const categorySelect = document.querySelector('select[name="category_id"]');
                    
                    // 清空现有选项
                    categorySelect.innerHTML = '';
                    
                    // 添加默认选项
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = '请选择分类';
                    categorySelect.appendChild(defaultOption);
                    
                    // 动态生成分类选项
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.category_name;
                        categorySelect.appendChild(option);
                    });
                } else {
                    console.error('获取分类数据失败:', data.msg);
                }
            })
            .catch(error => {
                console.error('获取分类数据时发生错误:', error);
            });
        }
        
        // 添加商品函数
        function addProduct() {
            // 获取表单数据
            const productForm = document.getElementById('product-form');
            const formData = new FormData(productForm);
            
            // 发送添加请求
            fetch('/products', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.code === 200) {
                    alert('商品添加成功');
                    // 跳转到商品管理页面
                    window.location.href = 'manage-products.html';
                } else {
                    alert('商品添加失败: ' + data.msg);
                }
            })
            .catch(error => {
                console.error('添加商品时发生错误:', error);
                alert('添加商品时发生错误');
            });
        }
        
        // 返回商品管理页面
        function goBack() {
            window.location.href = 'manage-products.html';
        }
    </script>
</body>
</html>