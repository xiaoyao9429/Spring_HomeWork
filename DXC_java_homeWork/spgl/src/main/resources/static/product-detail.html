<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品详情 - 商品管理系统</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- 头部 -->
    <header class="header">
        <div class="container">
            <h1>商品管理系统</h1>
        </div>
    </header>

    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="container">
            <ul>
                <li><a href="index.html">首页</a></li>
                <li><a href="product-list.html">商品列表</a></li>
                <li><a href="manage-products.html">管理商品</a></li>
            </ul>
        </div>
    </nav>

    <!-- 主内容 -->
    <main class="main">
        <div class="container">
            <div class="product-detail">
                <h2>智能手机</h2>
                
                <div class="product-detail-content">
                    <!-- 商品图片 -->
                    <div class="product-detail-image">
                        <div class="product-image">
                            <img src="" alt="商品图片" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                    </div>
                    
                    <!-- 商品信息 -->
                    <div class="product-detail-info">
                        <p class="product-price">¥2999.00</p>
                        <p class="product-stock">库存: 50</p>
                        <p class="product-category">分类: 电子产品</p>
                        
                        <h3>商品描述</h3>
                        <p class="product-description">
                            这是一款高性能智能手机，采用最新的处理器技术，拥有6.5英寸高清显示屏，分辨率达到2K级别。
                            内置大容量电池，支持快速充电，续航时间长达12小时。摄像头系统采用多镜头设计，支持4K视频录制。
                            机身采用玻璃材质，支持无线充电和防水功能。
                        </p>
                        
                        <div class="product-actions">
                            <a href="edit-product.html?id=1" class="btn btn-warning">编辑商品</a>
                            <a href="#" class="btn btn-danger">删除商品</a>
                            <a href="product-list.html" class="btn">返回列表</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 商品管理系统.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 从URL中获取商品ID
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            if (productId) {
                // 加载商品详情
                loadProductDetails(parseInt(productId));
            } else {
                alert('商品ID不存在');
                window.location.href = 'product-list.html';
            }
        });
        
        // 加载商品详情函数
        function loadProductDetails(id) {
            // 发送获取商品详情请求
            fetch(`/products/${id}`)
            .then(response => response.json())
            .then(data => {
                if (data.code === 200) {
                    const product = data.data;
                    
                    // 获取分类数据
                    fetch('/categories')
                    .then(categoryResponse => categoryResponse.json())
                    .then(categoryData => {
                        if (categoryData.code === 200 && categoryData.data) {
                            const categories = categoryData.data;
                            
                            // 使用商品实际图片
                            const productImageContainer = document.querySelector('.product-image');
                            const productImage = document.querySelector('.product-image img');
                            let imagePath = '';
                            
                            if (product.product_image && productImage) {
                                imagePath = `photo/${product.product_image}`;
                                productImage.src = imagePath;
                                productImage.alt = product.name;
                                productImage.style.display = 'block'; // 确保图片可见
                            } else {
                                // 当没有图片时显示默认占位符
                                if (productImage) {
                                    productImage.style.display = 'none'; // 隐藏图片标签
                                }
                                // 在容器中添加占位符文本
                                const placeholder = document.createElement('div');
                                placeholder.textContent = '📷';
                                placeholder.style.fontSize = '3rem';
                                placeholder.style.color = '#bdc3c7';
                                placeholder.style.display = 'flex';
                                placeholder.style.alignItems = 'center';
                                placeholder.style.justifyContent = 'center';
                                placeholder.style.width = '100%';
                                placeholder.style.height = '100%';
                                
                                // 检查容器中是否已有占位符，如果没有则添加
                                if (!productImageContainer.querySelector('.placeholder')) {
                                    placeholder.className = 'placeholder';
                                    productImageContainer.appendChild(placeholder);
                                }
                            }
                            
                            // 获取分类名称
                            const category = categories.find(cat => cat.id === product.category_id);
                            const categoryName = category ? category.category_name : '未分类';
                            
                            // 更新页面标题
                            document.title = `${product.name} - 商品管理系统`;
                            
                            // 填充商品信息
                            document.querySelector('h2').textContent = product.name;
                            // 不需要再次设置图片，因为之前已经设置过了
                            // if (productImage) {
                            //     productImage.src = imagePath;
                            //     productImage.alt = product.name;
                            // }
                            document.querySelector('.product-price').textContent = `¥${product.price.toFixed(2)}`;
                            document.querySelector('.product-stock').textContent = `库存: ${product.stock}`;
                            document.querySelector('.product-category').textContent = `分类: ${categoryName}`;
                            document.querySelector('.product-description').textContent = product.description;
                            
                            // 更新操作按钮的链接
                            const editLink = document.querySelector('.btn-warning');
                            const deleteBtn = document.querySelector('.btn-danger');
                            const backLink = document.querySelector('.product-actions .btn:nth-child(3)');
                            
                            if (editLink) {
                                editLink.href = `edit-product.html?id=${product.id}`;
                            }
                            
                            if (deleteBtn) {
                                deleteBtn.addEventListener('click', function() {
                                    deleteProduct(product.id);
                                });
                            }
                            
                            if (backLink) {
                                backLink.href = 'product-list.html';
                            }
                        } else {
                            console.error('获取分类数据失败:', categoryData.msg);
                        }
                    })
                    .catch(error => {
                        console.error('获取分类数据时发生错误:', error);
                    });
                } else {
                    alert('商品不存在: ' + data.msg);
                    window.location.href = 'product-list.html';
                }
            })
            .catch(error => {
                console.error('获取商品详情时发生错误:', error);
                alert('获取商品详情时发生错误');
            });
        }
        
        // 删除商品函数
        function deleteProduct(id) {
            // 确认删除
            if (confirm('确定要删除这个商品吗？')) {
                // 发送删除请求
                fetch(`/products?id=${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        alert('商品删除成功');
                        // 跳转到商品列表页面
                        window.location.href = 'product-list.html';
                    } else {
                        alert('商品删除失败: ' + data.msg);
                    }
                })
                .catch(error => {
                    console.error('删除商品时发生错误:', error);
                    alert('删除商品时发生错误');
                });
            }
        }
    </script>
</body>
</html>