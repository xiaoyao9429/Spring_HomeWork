<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品列表 - 商品管理系统</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- 头部 -->
    <header class="header">
        <div class="container">
            <h1>商品管理系统</h1>
        </div>
    </header>

    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="container">
            <ul>
                <li><a href="index.html">首页</a></li>
                <li><a href="product-list.html">商品列表</a></li>
                <li><a href="manage-products.html">管理商品</a></li>
            </ul>
        </div>
    </nav>

    <!-- 主内容 -->
    <main class="main">
        <div class="container">
            <h2>商品列表</h2>
            
            <!-- 搜索和筛选 -->
            <div class="search-filter">
                <form action="#" method="get">
                    <div class="form-group">
                        <input type="text" name="search" placeholder="搜索商品名称...">
                        <select name="category">
                            <option value="">全部分类</option>
                            <option value="1">电子产品</option>
                            <option value="2">家居用品</option>
                            <option value="3">服装鞋帽</option>
                            <option value="4">食品饮料</option>
                        </select>
                        <button type="submit" class="btn">搜索</button>
                    </div>
                </form>
            </div>

            <!-- 商品展示 -->
            <div class="product-grid">
                <!-- 商品卡片1 -->
                <div class="product-card">
                    <div class="product-image">📱</div>
                    <div class="product-info">
                        <h4 class="product-name">智能手机</h4>
                        <p class="product-price">¥2999.00</p>
                        <p class="product-description">高清屏幕，强大性能，长续航</p>
                        <p class="product-stock">库存: 50</p>
                        <a href="product-detail.html?id=1" class="btn">查看详情</a>
                    </div>
                </div>

                <!-- 商品卡片2 -->
                <div class="product-card">
                    <div class="product-image">💻</div>
                    <div class="product-info">
                        <h4 class="product-name">笔记本电脑</h4>
                        <p class="product-price">¥5999.00</p>
                        <p class="product-description">轻薄便携，高性能处理器</p>
                        <p class="product-stock">库存: 30</p>
                        <a href="product-detail.html?id=2" class="btn">查看详情</a>
                    </div>
                </div>

                <!-- 商品卡片3 -->
                <div class="product-card">
                    <div class="product-image">🎧</div>
                    <div class="product-info">
                        <h4 class="product-name">无线耳机</h4>
                        <p class="product-price">¥899.00</p>
                        <p class="product-description">降噪功能，优质音质</p>
                        <p class="product-stock">库存: 100</p>
                        <a href="product-detail.html?id=3" class="btn">查看详情</a>
                    </div>
                </div>

                <!-- 商品卡片4 -->
                <div class="product-card">
                    <div class="product-image">⌚</div>
                    <div class="product-info">
                        <h4 class="product-name">智能手表</h4>
                        <p class="product-price">¥1299.00</p>
                        <p class="product-description">健康监测，运动追踪</p>
                        <p class="product-stock">库存: 45</p>
                        <a href="product-detail.html?id=4" class="btn">查看详情</a>
                    </div>
                </div>

                <!-- 商品卡片5 -->
                <div class="product-card">
                    <div class="product-image">📺</div>
                    <div class="product-info">
                        <h4 class="product-name">智能电视</h4>
                        <p class="product-price">¥3999.00</p>
                        <p class="product-description">4K分辨率，智能系统</p>
                        <p class="product-stock">库存: 25</p>
                        <a href="product-detail.html?id=5" class="btn">查看详情</a>
                    </div>
                </div>

                <!-- 商品卡片6 -->
                <div class="product-card">
                    <div class="product-image">🎮</div>
                    <div class="product-info">
                        <h4 class="product-name">游戏主机</h4>
                        <p class="product-price">¥2699.00</p>
                        <p class="product-description">高性能游戏体验</p>
                        <p class="product-stock">库存: 40</p>
                        <a href="product-detail.html?id=6" class="btn">查看详情</a>
                    </div>
                </div>
            </div>

            <!-- 分页 -->
            <div class="pagination">
                <a href="#" class="btn">上一页</a>
                <a href="#" class="btn">1</a>
                <a href="#" class="btn">2</a>
                <a href="#" class="btn">3</a>
                <a href="#" class="btn">下一页</a>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 商品管理系统.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 加载分类数据
            loadCategories();
            // 加载商品列表
            loadProducts();
            
            // 搜索表单提交事件
            const searchForm = document.querySelector('.search-filter form');
            searchForm.addEventListener('submit', function(e) {
                e.preventDefault();
                loadProducts();
            });
        });
        
        // 加载分类数据函数
        function loadCategories() {
            fetch('/categories')
            .then(response => response.json())
            .then(data => {
                if (data.code === 200 && data.data) {
                    const categories = data.data;
                    const categorySelect = document.querySelector('select[name="category"]');
                    
                    // 清空现有选项（保留第一个“全部分类”选项）
                    const firstOption = categorySelect.firstElementChild;
                    categorySelect.innerHTML = '';
                    categorySelect.appendChild(firstOption);
                    
                    // 动态生成分类选项
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.category_name;
                        categorySelect.appendChild(option);
                    });
                } else {
                    console.error('获取分类数据失败:', data.msg);
                }
            })
            .catch(error => {
                console.error('获取分类数据时发生错误:', error);
            });
        }
        
        // 加载商品列表函数
        function loadProducts() {
            // 获取搜索参数
            const searchInput = document.querySelector('input[name="search"]');
            const categorySelect = document.querySelector('select[name="category"]');
            const searchValue = searchInput ? searchInput.value : '';
            const categoryValue = categorySelect ? categorySelect.value : '';
            
            // 构建请求URL
            let url = '/products';
            let params = [];
            if (searchValue) {
                params.push(`name=${encodeURIComponent(searchValue)}`);
            }
            if (categoryValue) {
                params.push(`category_id=${categoryValue}`);
            }
            if (params.length > 0) {
                url += '?' + params.join('&');
            }
            
            // 获取商品列表
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const products = data.data;
                        const productGrid = document.querySelector('.product-grid');
                        
                        // 清空现有商品卡片
                        productGrid.innerHTML = '';
                        
                        // 获取分类数据用于显示
                        fetch('/categories')
                        .then(categoryResponse => categoryResponse.json())
                        .then(categoryData => {
                            let categories = [];
                            if (categoryData.code === 200 && categoryData.data) {
                                categories = categoryData.data;
                            }
                            
                            // 动态生成商品卡片
                            products.forEach(product => {
                                const productCard = document.createElement('div');
                                productCard.className = 'product-card';
                                
                                // 创建商品图片
                                const productImage = document.createElement('div');
                                productImage.className = 'product-image';
                                const img = document.createElement('img');
                                img.src = `photo/${product.product_image}`;
                                img.alt = product.name;
                                img.style.width = '100%';
                                img.style.height = '100%';
                                img.style.objectFit = 'cover';
                                productImage.appendChild(img);
                                
                                // 创建商品信息
                                const productInfo = document.createElement('div');
                                productInfo.className = 'product-info';
                                
                                // 创建商品名称
                                const productName = document.createElement('h4');
                                productName.className = 'product-name';
                                productName.textContent = product.name;
                                
                                // 创建商品价格
                                const productPrice = document.createElement('p');
                                productPrice.className = 'product-price';
                                productPrice.textContent = `¥${product.price.toFixed(2)}`;
                                
                                // 创建商品描述
                                const productDescription = document.createElement('p');
                                productDescription.className = 'product-description';
                                productDescription.textContent = product.description;
                                
                                // 创建商品库存
                                const productStock = document.createElement('p');
                                productStock.className = 'product-stock';
                                productStock.textContent = `库存: ${product.stock}`;
                                
                                // 创建查看详情按钮
                                const viewDetailLink = document.createElement('a');
                                viewDetailLink.href = `product-detail.html?id=${product.id}`;
                                viewDetailLink.className = 'btn';
                                viewDetailLink.textContent = '查看详情';
                                
                                // 组装商品信息
                                productInfo.appendChild(productName);
                                productInfo.appendChild(productPrice);
                                productInfo.appendChild(productDescription);
                                productInfo.appendChild(productStock);
                                productInfo.appendChild(viewDetailLink);
                                
                                // 组装商品卡片
                                productCard.appendChild(productImage);
                                productCard.appendChild(productInfo);
                                
                                // 添加到商品网格
                                productGrid.appendChild(productCard);
                            });
                        })
                        .catch(error => {
                            console.error('获取分类数据时发生错误:', error);
                        });
                    } else {
                        alert('获取商品列表失败: ' + data.msg);
                    }
                })
                .catch(error => {
                    console.error('获取商品列表时发生错误:', error);
                    alert('获取商品列表时发生错误');
                });
        }
    </script>
</body>
</html>